/*! selection.js - v0.0.1 - 2013-06-28
* https://github.com/wooorm/selection.js
* Copyright (c) 2013 wooorm; Licensed MIT */
!function(a){return"function"==typeof define&&define.amd?define(a):this.Selection=a()}.call(this,function(){var a,b,c,d,e;return e=this,d=["mouseup","keyup"],c="",a=function(a){var c=this;return a||(a=e),"function"!=typeof a.getSelection?!1:(this._selection=a.getSelection(),this._global=a,this._listener=function(){return b._listener.apply(c,arguments)},this.events=d,this)},b=a.prototype={},b._listener=function(a){var b=this;return setTimeout(function(){var d,e,f,g;return g=c+b._selection,g!==b._previousValue?(g===c?(f="deselection",d={}):(f="selection",d=b.get()),d.originalEvent=a,e=b._global.document.createEvent("CustomEvent"),e.initCustomEvent(f,!1,!1,d),b._global.dispatchEvent(e),b._previousValue=g):void 0},0),this},b.listen=function(){var a,b,d,e,f;for(this._previousValue=c,e=-1,d=this.events,f=d.length,a=this._global.document;++e<f;)b=d[e],a.addEventListener(b,this._listener,!1);return this},b.ignore=function(){var a,b,c,d,e;for(d=-1,c=this.events,e=c.length,a=this._global.document;++d<e;)b=c[d],a.removeEventListener(b,this._listener,!1);return this},b.has=function(){var a;return a=this._selection,a&&null!=a.focusNode&&null!=a.anchorNode},b.set=function(a,b,c,d){var e,f;if(f=this._selection,null==f)return!1;if(null==a)return!1;if(null==b&&(b=0),(c===a||null==c)&&(null!=a.firstChild&&null!=a.lastChild?(c=a.lastChild,a=a.firstChild):c=a),null==d&&(d=this._isText(c)?c.textContent.length:null!=c.childNodes?c.childNodes.length:0),f.collapse&&f.extend)f.collapse(a,b),f.extend(c,d);else{e=this._global.document.createRange(),e.setStart(a,b),e.setEnd(c,d);try{f.removeAllRanges()}catch(g){}f.addRange(e)}return this},b.get=function(){var a;return this.has()?(a=this._get(),a.value=c+this._selection,a):!1},b.clear=function(){try{this._selection.removeAllRanges()}catch(a){}return this},b.getStart=function(){var a;return a=this._selection,a||null==a.anchorNode?{$node:a.anchorNode,offset:a.anchorOffset}:!1},b.getEnd=function(){var a;return a=this._selection,a||null==a.focusNode?{$node:a.focusNode,offset:a.focusOffset}:!1},b.getTop=function(){var a;return a=this._get(),{$node:a.$top,offset:a.topOffset}},b.getBottom=function(){var a;return a=this._get(),{$node:a.$bottom,offset:a.bottomOffset}},b._isPreceding=function(a,b){return 2&b.compareDocumentPosition(a)},b._contains=function(a,b){return 16&a.compareDocumentPosition(b)},b._isText=function(a){return a&&3===a.nodeType},b._precedes=function(a,b,c,d){return a===c?d>=b:this._isText(a)&&this._isText(c)?this._isPreceding(a,c):this._isText(a)&&!this._isText(c)?!this._precedes(c,d,a,b):this._contains(a,c)?a.childNodes.length<=b?!1:a.childNodes[b]===c?d>=0:this._isPreceding(a.childNodes[b],c):this._isPreceding(a,c)},b._get=function(){var a,b,c,d;return this.has()?(c=this.getStart(),b=this.getEnd(),this._precedes(c.$node,c.offset,b.$node,b.offset)?(d=c,a=b):(d=b,a=c),{$start:c.$node,startOffset:c.offset,$end:b.$node,endOffset:b.offset,$top:d.$node,topOffset:d.offset,$bottom:a.$node,bottomOffset:a.offset}):!1},a});